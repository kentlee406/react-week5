import{r as d,u as g,k as e}from"./vendor-1KhO9Br4.js";import{a as j}from"./vendor-router-BuaAtQMK.js";import{a as t}from"./vendor-axios-B9ygI19o.js";import{a as N,u as b}from"./index-C_e115xw.js";import"./vendor-redux-jjwltitj.js";import"./vendor-bootstrap-CjPjBXCY.js";const u="https://ec-course-api.hexschool.io/v2";function L(){const n=j(),{showLoading:r,hideLoading:i}=d.useContext(N),{showNotification:p}=b(),{register:c,handleSubmit:l,formState:{errors:o}}=g(),h=async s=>{try{r();const a=await t.post(`${u}/admin/signin`,s),{token:m,expired:f}=a.data;document.cookie=`hexToken=${m};expires=${new Date(f)};`,t.defaults.headers.common.Authorization=`${m}`,n("/admin/product")}catch{p("登入失敗，請檢查帳號密碼","error",8e3),i()}};d.useEffect(()=>{const s=document.cookie.split("; ").find(a=>a.startsWith("hexToken="))?.split("=")[1];s&&x(s)},[]);async function x(s){try{r(),t.defaults.headers.common.Authorization=s,await t.post(`${u}/api/user/check`),n("/admin/product")}catch{console.error("驗證失敗或 Token 已過期，請重新登入"),t.defaults.headers.common.Authorization="",i()}}return e.jsx("div",{className:"container",children:e.jsx("div",{className:"row justify-content-center",children:e.jsxs("div",{className:"col-6",children:[e.jsx("h2",{children:"後台登入"}),e.jsxs("form",{id:"form",className:"form-signin",onSubmit:l(h),children:[e.jsxs("div",{className:"input-group",children:[e.jsx("span",{className:"input-group-text",children:"帳號"}),e.jsx("input",{type:"email",className:"form-control",placeholder:"請輸入帳號",...c("username",{required:"帳號為必填"}),autoComplete:"current-username"}),o.username&&e.jsx("span",{className:"text-danger",children:o.username.message})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("span",{className:"input-group-text",children:"密碼"}),e.jsx("input",{type:"password",className:"form-control",placeholder:"請輸入密碼",...c("password",{required:"密碼為必填"}),autoComplete:"current-password"}),o.password&&e.jsx("span",{className:"text-danger",children:o.password.message})]}),e.jsx("button",{type:"submit",className:"btn btn-primary mb-3",children:"登入"}),e.jsx("button",{type:"button",className:"btn btn-secondary mb-3 ms-2",onClick:()=>n("/"),children:"返回前台首頁"})]})]})})})}export{L as default};
