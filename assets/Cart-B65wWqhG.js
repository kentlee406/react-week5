import{r as h,u as $,k as e}from"./vendor-1KhO9Br4.js";import{a as c}from"./vendor-axios-B9ygI19o.js";import"./vendor-bootstrap-CjPjBXCY.js";import{a as v,u as w}from"./index-Dys8dRAb.js";import"./vendor-router-BuaAtQMK.js";import"./vendor-redux-jjwltitj.js";const i="https://ec-course-api.hexschool.io/v2",d="kentlee406";function L(){const[x,p]=h.useState([]),[b,f]=h.useState(0),[o,a]=h.useState(!1),{showLoading:j,hideLoading:u}=h.useContext(v),{showNotification:r}=w(),{register:m,handleSubmit:y,reset:N,formState:{errors:t}}=$(),g=async s=>{try{j(),a(!0);const n={data:{user:{name:s.name,email:s.email,tel:s.telephone,address:s.address},message:s.memo||""}};await c.post(`${i}/api/${d}/order`,n),r("訂單送出成功","success",6e3),N(),l()}catch{r("送出訂單失敗，請稍後再試","error",8e3),u()}finally{a(!1)}},l=async()=>{try{j();const s=await c.get(`${i}/api/${d}/cart`);p(s.data.data.carts),f(s.data.data.final_total)}catch{r("取得購物車資料失敗，請稍後再試","error",8e3)}finally{u()}};return h.useEffect(()=>{l()},[]),e.jsxs(e.Fragment,{children:[e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{colSpan:"2",children:"產品"}),e.jsx("th",{children:"單價"}),e.jsx("th",{children:"數量"}),e.jsx("th",{children:"價格"}),e.jsx("th",{children:"操作"})]})}),e.jsxs("tbody",{children:[x.length>0?x.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("img",{src:s.product.imageUrl||null,alt:s.product.title,width:"100"})}),e.jsx("td",{children:s.product.title}),e.jsx("td",{children:s.product.price}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("button",{className:"btn btn-secondary btn-sm me-2",disabled:o,onClick:async()=>{const n=s.qty-1;if(!(n<1))try{a(!0),await c.put(`${i}/api/${d}/cart/${s.id}`,{data:{product_id:s.product.id,qty:n}}),l()}catch{r("更新數量失敗，請稍後再試","error",8e3)}finally{a(!1)}},children:"-"}),e.jsx("span",{children:s.qty}),e.jsx("button",{className:"btn btn-secondary btn-sm ms-2",disabled:o,onClick:async()=>{const n=s.qty+1;try{a(!0),await c.put(`${i}/api/${d}/cart/${s.id}`,{data:{product_id:s.product.id,qty:n}}),l()}catch{r("更新數量失敗，請稍後再試","error",8e3)}finally{a(!1)}},children:"+"}),e.jsx("span",{className:"ms-2",children:s.product.unit})]})}),e.jsx("td",{children:s.final_total}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-danger btn-sm",disabled:o,onClick:async()=>{if(confirm("確定要刪除此項目嗎？"))try{a(!0),await c.delete(`${i}/api/${d}/cart/${s.id}`),l()}catch{r("刪除失敗，請稍後再試","error",8e3)}finally{a(!1)}},children:"刪除"})})]},s.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"6",children:"購物車已清空"})}),e.jsxs("tr",{children:[e.jsx("td",{colSpan:"4",children:e.jsx("b",{children:"總金額"})}),e.jsx("td",{children:e.jsx("b",{children:b})}),e.jsx("td",{})]})]})]}),e.jsx("div",{className:"mb-3",children:e.jsx("button",{className:"btn btn-outline-danger",disabled:x.length===0||o,onClick:async()=>{if(confirm("確定要清空購物車嗎？"))try{a(!0),await c.delete(`${i}/api/${d}/carts`),l()}catch{r("清空購物車失敗，請稍後再試","error",8e3)}finally{a(!1)}},children:"清空購物車"})}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{children:"結帳資訊"}),e.jsxs("form",{onSubmit:y(g),children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"form-label",children:"姓名"}),e.jsx("input",{className:"form-control",...m("name",{required:"姓名為必填"})}),t.name&&e.jsx("div",{className:"text-danger",children:t.name.message})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"form-label",children:"電子郵件"}),e.jsx("input",{type:"email",className:"form-control",...m("email",{required:"Email 為必填",pattern:{value:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,message:"請輸入正確的 Email"}})}),t.email&&e.jsx("div",{className:"text-danger",children:t.email.message})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"form-label",children:"地址"}),e.jsx("input",{className:"form-control",...m("address",{required:"地址為必填"})}),t.address&&e.jsx("div",{className:"text-danger",children:t.address.message})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"form-label",children:"電話"}),e.jsx("input",{type:"tel",className:"form-control",...m("telephone",{required:"電話為必填",pattern:{value:/^[0-9]{10}$/,message:"請輸入 10 位數字，如 0912345678"}})}),t.telephone&&e.jsx("div",{className:"text-danger",children:t.telephone.message})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{className:"form-label",children:"備註"}),e.jsx("textarea",{className:"form-control",...m("memo")})]}),e.jsx("button",{className:"btn btn-success",type:"submit",disabled:x.length===0||o,children:"送出訂單"})]})]})]})}export{L as default};
